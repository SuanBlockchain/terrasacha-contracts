<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Cardano smart contracts for carbon credit tokens and NFTs built with OpShin"><meta name=author content=larestrepo><link href=https://suanblockchain.github.io/terrasacha-contracts/contracts/details/ rel=canonical><link href=../protocol-nfts/ rel=prev><link href=../validations/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.21"><title>Contract Details - Terrasacha Contracts</title><link rel=stylesheet href=../../assets/stylesheets/main.2a3383ac.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=green data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#diseno-de-contratos-inteligentes class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Terrasacha Contracts" class="md-header__button md-logo" aria-label="Terrasacha Contracts" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Terrasacha Contracts </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Contract Details </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=green data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=green data-md-color-accent=teal aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/SuanBlockchain/terrasacha-contracts title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> SuanBlockchain/terrasacha-contracts </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../architecture/overview/ class=md-tabs__link> Architecture </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../protocol-validator/ class=md-tabs__link> Contracts </a> </li> <li class=md-tabs__item> <a href=../../api/validators/ class=md-tabs__link> API Reference </a> </li> <li class=md-tabs__item> <a href=../../testing/overview/ class=md-tabs__link> Testing </a> </li> <li class=md-tabs__item> <a href=../../development/build-system/ class=md-tabs__link> Development </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Terrasacha Contracts" class="md-nav__button md-logo" aria-label="Terrasacha Contracts" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Terrasacha Contracts </label> <div class=md-nav__source> <a href=https://github.com/SuanBlockchain/terrasacha-contracts title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> SuanBlockchain/terrasacha-contracts </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../architecture/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/validators/ class=md-nav__link> <span class=md-ellipsis> Validators </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/minting-policies/ class=md-nav__link> <span class=md-ellipsis> Minting Policies </span> </a> </li> <li class=md-nav__item> <a href=../../architecture/types/ class=md-nav__link> <span class=md-ellipsis> Types & Datums </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Contracts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Contracts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../protocol-validator/ class=md-nav__link> <span class=md-ellipsis> Protocol Validator </span> </a> </li> <li class=md-nav__item> <a href=../protocol-nfts/ class=md-nav__link> <span class=md-ellipsis> Protocol NFTs </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Contract Details </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Contract Details </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#descripcion-de-tokens class=md-nav__link> <span class=md-ellipsis> Descripción de tokens </span> </a> <nav class=md-nav aria-label="Descripción de tokens"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tokens-nft class=md-nav__link> <span class=md-ellipsis> Tokens NFT </span> </a> </li> <li class=md-nav__item> <a href=#tokens-ft class=md-nav__link> <span class=md-ellipsis> Tokens FT </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#descripcion-tipos-de-contratos class=md-nav__link> <span class=md-ellipsis> Descripción tipos de contratos </span> </a> <nav class=md-nav aria-label="Descripción tipos de contratos"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#contratos-de-tipo-minteo class=md-nav__link> <span class=md-ellipsis> Contratos de tipo minteo </span> </a> </li> <li class=md-nav__item> <a href=#contratos-de-tipo-gasto class=md-nav__link> <span class=md-ellipsis> Contratos de tipo gasto </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lista-de-contratos-principales-y-su-arquitectura class=md-nav__link> <span class=md-ellipsis> Lista de contratos principales y su arquitectura </span> </a> <nav class=md-nav aria-label="Lista de contratos principales y su arquitectura"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#contrato-nft-autorizacion-protocolo-tipo-minting class=md-nav__link> <span class=md-ellipsis> Contrato NFT autorización protocolo (Tipo Minting) </span> </a> <nav class=md-nav aria-label="Contrato NFT autorización protocolo (Tipo Minting)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-protocolo-tipo-spending class=md-nav__link> <span class=md-ellipsis> Contrato de Protocolo (Tipo Spending) </span> </a> <nav class=md-nav aria-label="Contrato de Protocolo (Tipo Spending)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_1 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> <li class=md-nav__item> <a href=#consideraciones-generales class=md-nav__link> <span class=md-ellipsis> Consideraciones generales </span> </a> </li> <li class=md-nav__item> <a href=#posibles-ataques class=md-nav__link> <span class=md-ellipsis> Posibles ataques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-nft-autorizacion-proyecto class=md-nav__link> <span class=md-ellipsis> Contrato NFT autorización proyecto </span> </a> <nav class=md-nav aria-label="Contrato NFT autorización proyecto"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_2 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-proyecto-tipo-spending class=md-nav__link> <span class=md-ellipsis> Contrato de Proyecto (tipo Spending) </span> </a> <nav class=md-nav aria-label="Contrato de Proyecto (tipo Spending)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_3 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> <li class=md-nav__item> <a href=#minteo-de-tokens-grises class=md-nav__link> <span class=md-ellipsis> Minteo de tokens grises </span> </a> </li> <li class=md-nav__item> <a href=#posibles-ataques_1 class=md-nav__link> <span class=md-ellipsis> Posibles ataques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-token-grises-tipo-minting class=md-nav__link> <span class=md-ellipsis> Contrato de token grises (tipo Minting) </span> </a> <nav class=md-nav aria-label="Contrato de token grises (tipo Minting)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_4 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../validations/ class=md-nav__link> <span class=md-ellipsis> Validations </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/validators/ class=md-nav__link> <span class=md-ellipsis> Validators </span> </a> </li> <li class=md-nav__item> <a href=../../api/minting-policies/ class=md-nav__link> <span class=md-ellipsis> Minting Policies </span> </a> </li> <li class=md-nav__item> <a href=../../api/types/ class=md-nav__link> <span class=md-ellipsis> Types </span> </a> </li> <li class=md-nav__item> <a href=../../api/utilities/ class=md-nav__link> <span class=md-ellipsis> Utilities </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Testing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../testing/overview/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../testing/running-tests/ class=md-nav__link> <span class=md-ellipsis> Running Tests </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Development </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../development/build-system/ class=md-nav__link> <span class=md-ellipsis> Build System </span> </a> </li> <li class=md-nav__item> <a href=../../development/cli-tools/ class=md-nav__link> <span class=md-ellipsis> CLI Tools </span> </a> </li> <li class=md-nav__item> <a href=../../development/claude-guide/ class=md-nav__link> <span class=md-ellipsis> Claude Guide </span> </a> </li> <li class=md-nav__item> <a href=../../development/contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#descripcion-de-tokens class=md-nav__link> <span class=md-ellipsis> Descripción de tokens </span> </a> <nav class=md-nav aria-label="Descripción de tokens"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tokens-nft class=md-nav__link> <span class=md-ellipsis> Tokens NFT </span> </a> </li> <li class=md-nav__item> <a href=#tokens-ft class=md-nav__link> <span class=md-ellipsis> Tokens FT </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#descripcion-tipos-de-contratos class=md-nav__link> <span class=md-ellipsis> Descripción tipos de contratos </span> </a> <nav class=md-nav aria-label="Descripción tipos de contratos"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#contratos-de-tipo-minteo class=md-nav__link> <span class=md-ellipsis> Contratos de tipo minteo </span> </a> </li> <li class=md-nav__item> <a href=#contratos-de-tipo-gasto class=md-nav__link> <span class=md-ellipsis> Contratos de tipo gasto </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#lista-de-contratos-principales-y-su-arquitectura class=md-nav__link> <span class=md-ellipsis> Lista de contratos principales y su arquitectura </span> </a> <nav class=md-nav aria-label="Lista de contratos principales y su arquitectura"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#contrato-nft-autorizacion-protocolo-tipo-minting class=md-nav__link> <span class=md-ellipsis> Contrato NFT autorización protocolo (Tipo Minting) </span> </a> <nav class=md-nav aria-label="Contrato NFT autorización protocolo (Tipo Minting)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-protocolo-tipo-spending class=md-nav__link> <span class=md-ellipsis> Contrato de Protocolo (Tipo Spending) </span> </a> <nav class=md-nav aria-label="Contrato de Protocolo (Tipo Spending)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_1 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> <li class=md-nav__item> <a href=#consideraciones-generales class=md-nav__link> <span class=md-ellipsis> Consideraciones generales </span> </a> </li> <li class=md-nav__item> <a href=#posibles-ataques class=md-nav__link> <span class=md-ellipsis> Posibles ataques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-nft-autorizacion-proyecto class=md-nav__link> <span class=md-ellipsis> Contrato NFT autorización proyecto </span> </a> <nav class=md-nav aria-label="Contrato NFT autorización proyecto"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_2 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-proyecto-tipo-spending class=md-nav__link> <span class=md-ellipsis> Contrato de Proyecto (tipo Spending) </span> </a> <nav class=md-nav aria-label="Contrato de Proyecto (tipo Spending)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_3 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> <li class=md-nav__item> <a href=#minteo-de-tokens-grises class=md-nav__link> <span class=md-ellipsis> Minteo de tokens grises </span> </a> </li> <li class=md-nav__item> <a href=#posibles-ataques_1 class=md-nav__link> <span class=md-ellipsis> Posibles ataques </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#contrato-de-token-grises-tipo-minting class=md-nav__link> <span class=md-ellipsis> Contrato de token grises (tipo Minting) </span> </a> <nav class=md-nav aria-label="Contrato de token grises (tipo Minting)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validaciones-del-contrato_4 class=md-nav__link> <span class=md-ellipsis> Validaciones del contrato </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=diseno-de-contratos-inteligentes>Diseño de Contratos Inteligentes<a class=headerlink href=#diseno-de-contratos-inteligentes title="Permanent link">&para;</a></h1> <h2 id=descripcion-de-tokens>Descripción de tokens<a class=headerlink href=#descripcion-de-tokens title="Permanent link">&para;</a></h2> <p>La aplicación hace uso de tokens tanto NFT como FT</p> <h3 id=tokens-nft>Tokens NFT<a class=headerlink href=#tokens-nft title="Permanent link">&para;</a></h3> <p>Los tokens NFT se utilizan principalmente para permitir la identificación de las UTXOs que pertenecen a la aplicación para leer información sensible almacenada en datums, principalmente en direcciones de billeteras principales y direcciones de contratos.</p> <h3 id=tokens-ft>Tokens FT<a class=headerlink href=#tokens-ft title="Permanent link">&para;</a></h3> <p>Existen dos tipos de tokens FT: tokens grises y tokens verdes.</p> <ul> <li><strong>Tokens grises</strong>: estos son tokens que representan un porcentaje de participación en el proyecto. Son una promesa futura de créditos de carbono que serán certificados si el proyecto es exitoso. Estos tokens se crean en una proporción de 1 token/1 tonelada de CO2eq con un suministro total fijo correspondiente a la estimación inicial. La estimación tiene asociada una incertidumbre que se representa mediante una cantidad denominada <em><strong>buffer</strong></em> para tener flexibilidad durante la realización de los certificados y mantener el equilibrio real de los créditos de carbono una vez confirmados.</li> <li><strong>Tokens verdes</strong>: representan 1 tonelada de CO2eq certificada por una entidad de certificación. La entidad de certificación emite un certificado que se bloquea en el sistema y se tokeniza por la cantidad de créditos de carbono establecida en el certificado en una proporción 1:1.</li> </ul> <hr> <h2 id=descripcion-tipos-de-contratos>Descripción tipos de contratos<a class=headerlink href=#descripcion-tipos-de-contratos title="Permanent link">&para;</a></h2> <p>En cardano se pueden definir varios tipos de contrato, especificados en el campo "purpose" dentro del contexto de la transacción:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>ScriptPurpose</span> <span class=o>=</span> <span class=n>Union</span><span class=p>[</span><span class=n>Minting</span><span class=p>,</span> <span class=n>Spending</span><span class=p>,</span> <span class=n>Rewarding</span><span class=p>,</span> <span class=n>Certifying</span><span class=p>]</span>
</span></code></pre></div> <p>En nuestra aplicación se van a utilizar únicamente dos, los cuales son los más comunes: de tipo "Minting" y de tipo "Spending"</p> <h3 id=contratos-de-tipo-minteo>Contratos de tipo minteo<a class=headerlink href=#contratos-de-tipo-minteo title="Permanent link">&para;</a></h3> <p>Se utilizan para crear tokens nativos y definir sus condiciones de creación o quema. En nuestra aplicación se pueden listar los siguientes:</p> <ul> <li>Para crear NFTs: usualmente crean un NFT de protocolo y un NFT de usuario siguiendo el estándar CIP68. Sirven como identificadores únicos para guardar información en datums (metadata) que los contrato de gasto pueden acceder como entrada en el proceso de validación.</li> <li>Para crear o quemar tokens grises: a nivel de proyecto, controlan la creación y quema de los FTs tokens grises.</li> <li>Para crear o quemar tokens verdes: a nivel de proyecto, controlan la creación y quema de los FTs tokens verdes.</li> </ul> <h3 id=contratos-de-tipo-gasto>Contratos de tipo gasto<a class=headerlink href=#contratos-de-tipo-gasto title="Permanent link">&para;</a></h3> <p>Se utilizan para definir reglas de validación para consumir utxos que contienen "lovelace" y/o tokens nativos, los cuales están alojados en la dirección del contrato. </p> <hr> <h2 id=lista-de-contratos-principales-y-su-arquitectura>Lista de contratos principales y su arquitectura<a class=headerlink href=#lista-de-contratos-principales-y-su-arquitectura title="Permanent link">&para;</a></h2> <h3 id=contrato-nft-autorizacion-protocolo-tipo-minting>Contrato NFT autorización protocolo (Tipo Minting)<a class=headerlink href=#contrato-nft-autorizacion-protocolo-tipo-minting title="Permanent link">&para;</a></h3> <p>Creación de dos tokens de autorización (referencia y usuario) siguiendo la especificación CIP68. Uno se envía a la billetera del usuario que crea el protocolo y el otro se envía a la dirección de gasto del contrato (Contrato Protocolo). El nombre del token se construye a partir de la UTXO de entrada (ID de entrada de transacción) y agregando un prefijo de la siguiente manera: REF_ para el NFT de referencia enviado al contrato, y USER_ enviado al usuario. Esto garantiza que los nombres de los tokens sean únicos y con un prefijo identificable.</p> <ul> <li>Parámetros</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=n>oref</span><span class=p>:</span> <span class=n>TxOutRef</span>
</span></code></pre></div> <ul> <li>Redeemer</li> </ul> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=k>class</span><span class=w> </span><span class=nc>Mint</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a><span class=k>class</span><span class=w> </span><span class=nc>Burn</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span></code></pre></div> <h4 id=validaciones-del-contrato>Validaciones del contrato<a class=headerlink href=#validaciones-del-contrato title="Permanent link">&para;</a></h4> <ol> <li>Valida que el propósito del contrato sea de tipo "Minting"</li> <li>Valida que 2 tokens sean creados o destruidos exactamente (1 reference, 1 usuario)</li> <li>Para minteo:<ol> <li>Valida que el parámetro utxo se consuma</li> <li>Valida que se crea un NFT de tipo protocolo</li> <li>Valida que se crea un NFT de tipo usuario</li> </ol> </li> <li>Para quema:<ol> <li>Valida que a la salida de la transacción no existan tokens con la misma política del contrato Este contrato puede ser utilizado libremente sin ninguna restricción. Su objetivo es generar identificadores únicos cuyos tokens, tanto referencia como usuario, sean utilizados en conjunto para desbloquear transacciones que requieran un acceso de administrador. </li> </ol> </li> </ol> <h3 id=contrato-de-protocolo-tipo-spending>Contrato de Protocolo (Tipo Spending)<a class=headerlink href=#contrato-de-protocolo-tipo-spending title="Permanent link">&para;</a></h3> <p>Gestiona los parámetros del protocolo para un fácil acceso en cadena. Contiene información en una UTXO, un datum sobre AdminWallet, OracleId, comisión durante la compra de tokens, listado de proyectos autorizados.</p> <p>Este contrato es responsable de salvaguardar la veracidad de la información contenida en su datum, actualizarlo y eliminarlo. </p> <ul> <li> <p>Parámetros <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=n>token_policy_id</span><span class=p>:</span> <span class=n>PolicyId</span>
</span></code></pre></div></p> </li> <li> <p>Redeemer <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>class</span><span class=w> </span><span class=nc>UpdateProtocol</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>protocol_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>    <span class=n>user_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>    <span class=n>protocol_output_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=k>class</span><span class=w> </span><span class=nc>EndProtocol</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>2</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a>    <span class=n>protocol_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>    <span class=n>user_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=n>RedeemerProtocol</span> <span class=o>=</span> <span class=n>Union</span><span class=p>[</span><span class=n>UpdateProtocol</span><span class=p>,</span> <span class=n>EndProtocol</span><span class=p>]</span>
</span></code></pre></div></p> </li> <li> <p>Datum <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=nd>@dataclass</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=k>class</span><span class=w> </span><span class=nc>DatumProtocol</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>protocol_admin</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>bytes</span><span class=p>]</span>  <span class=c1># List of admin public key hashes</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>protocol_fee</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Protocol fee in lovelace</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=n>oracle_id</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Oracle identifier</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=n>projects</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=nb>bytes</span><span class=p>]</span>  <span class=c1># Project identifier</span>
</span></code></pre></div></p> </li> </ul> <h4 id=validaciones-del-contrato_1>Validaciones del contrato<a class=headerlink href=#validaciones-del-contrato_1 title="Permanent link">&para;</a></h4> <ol> <li>Valida que el propósito del contrato sea de tipo "Spending"</li> <li>Valida que el input utilizado para encontrar el token de referencia sea el del protocolo oficial</li> <li>Valida que el usuario que está interactuando con el contrato tenga su token de autorización</li> <li>Valida que no se pueda utilizar más de un utxo a la vez proveniente de la dirección del contrato</li> <li>En UpdateProtocol<ol> <li>Valida que el token no se envíe a una dirección distinta a la del contrato</li> <li>Valida que el datum se actualice de acuerdo a las siguientes restricciones:<ol> <li>Los fees del protocol &gt;= 0</li> <li>El número de administradores de proyectos &lt;=10</li> <li>El número de proyectos gestionados por el mismo protocolo &lt;=10</li> </ol> </li> </ol> </li> <li>Para EndProtocol<ol> <li>Valida que los tokens desaparezcan al ser quemados por el contrato de quema.</li> </ol> </li> </ol> <h4 id=consideraciones-generales>Consideraciones generales<a class=headerlink href=#consideraciones-generales title="Permanent link">&para;</a></h4> <ul> <li>Cualquier persona o entidad puede desarrollar por completo el protocol con sus tokens de validación. Sin embargo, los protocolos desplegados son completamente independientes de tal forma que los proyectos asociados en cada uno, son igualmente independientes. </li> <li>Cualquier persona que esté en posesión del token de autorización está en la capacidad de realizar modificaciones al datum del protocolo.</li> <li>El token de referencia sirve para oficializar el utxo que tiene el datum con la información sensible del protocolo.</li> <li>El protocolo está diseñado para nunca liberar el nft de referencia de su contrato. La única salida posible es con el quemado del token y por lo tanto su fnalización. </li> </ul> <h4 id=posibles-ataques>Posibles ataques<a class=headerlink href=#posibles-ataques title="Permanent link">&para;</a></h4> <p>Una vez desplegado el protocolo los ataques se centran en los siguientes frentes: 1. Modificación del datum por parte de usuarios no autorizados. 2. Sacar el token de la dirección del contrato. 3. Finalizar el protocolo quemando el token.</p> <p>Escenarios: - Que alguien envíe un nft de referencia ficticio a la dirección del contrato y trate de desbloquear el nft original junto con el ficticio para modificar el datum del original. - Salvaguarda: sólo un utxo de la dirección del contrato puede ser consumido a la vez en una transacción. - Que alguien envíe índices de redeemers falsos para validar funciones del contrato que dependen de los índices que provee el usuario en el redeemer. - Salvaguarda: el parámetro token_policy_id identifica el token oficial y por lo tanto todos los inputs de referencia deben contener el token oficial de acuerdo a este policy.</p> <hr> <h3 id=contrato-nft-autorizacion-proyecto>Contrato NFT autorización proyecto<a class=headerlink href=#contrato-nft-autorizacion-proyecto title="Permanent link">&para;</a></h3> <p>Creación de dos tokens de autorización (referencia y usuario) siguiendo la especificación CIP68. Uno se envía a la billetera del usuario que crea el proyecto y el otro se envía a la dirección de gasto del contrato (Contrato Proyecto). El nombre del token se construye a partir de la UTXO de entrada (ID de entrada de transacción) y agregando un prefijo de la siguiente manera: REF_ para el NFT de referencia enviado al contrato, y USER_ enviado al usuario. Esto garantiza que los nombres de los tokens sean únicos y con un prefijo identificable. </p> <p>Es un contrato similar al utilizado para el protocolo sin embargo tiene una validación adicional y es que los que firman la transacción para poder generar estos tokens deben estar listados en el campo project_admins del DatumProtocol.</p> <ul> <li>Parámetros <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=n>oref</span><span class=p>:</span> <span class=n>TxOutRef</span><span class=p>,</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>protocol_policy_id</span><span class=p>:</span> <span class=n>PolicyId</span>
</span></code></pre></div></li> <li>Redeemer <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>class</span><span class=w> </span><span class=nc>MintProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>protocol_input_index</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Index of the input UTXO to be consumed</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=k>class</span><span class=w> </span><span class=nc>BurnProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a>    <span class=n>protocol_input_index</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Index of the reference input UTXO</span>
</span></code></pre></div></li> </ul> <h4 id=validaciones-del-contrato_2>Validaciones del contrato<a class=headerlink href=#validaciones-del-contrato_2 title="Permanent link">&para;</a></h4> <ol> <li>Valida que el propósito del contrato sea de tipo "Minting"</li> <li>Valida que solamente se creen dos tipos de tokens</li> <li>Valida que el protocolo de referencia sea el correcto compárando la política del protocolo</li> <li>Valida que el utxo del protocolo contenga el token esperado</li> <li>Valida que quien firma la transacción haga parta de la lista de administradores en el datum del protocolo</li> <li>Para minteo:<ol> <li>Valida que el parámetro utxo se consuma</li> <li>Valida que se crea un NFT de tipo protocolo</li> <li>Valida que se crea un NFT de tipo usuario</li> </ol> </li> <li>Para quema:<ol> <li>Valida que a la salida de la transacción no existan tokens con la misma política del contrato</li> </ol> </li> </ol> <p>Este contrato está atado al protocolo utilizando la política del protocolo como parámetro de inicialización. Su objetivo es generar identificadores únicos cuyos tokens, tanto referencia como usuario, deben ser utilizados en conjunto para desbloquear transacciones asociadas a actualizaciones del proyecto. A través de la validación de los administradores listados en el datum del protocolo se determina quiénes pueden crear o destruir estos certificados, y por lo tanto ser los administradores de proyectos.</p> <h3 id=contrato-de-proyecto-tipo-spending>Contrato de Proyecto (tipo Spending)<a class=headerlink href=#contrato-de-proyecto-tipo-spending title="Permanent link">&para;</a></h3> <p>Gestiona los datos y parámetros del proyecto. El datum contiene información relevante del proyecto como datos generales, así como la economía del token en cuanto a listado de participantes con sus proporciones y las reglas para su distribución. </p> <p>Este contrato es responsable de salvaguardar la veracidad de la información contenida en su datum, actualizarlo y eliminarlo. </p> <ul> <li> <p>Parámetros <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>token_policy_id</span><span class=p>:</span> <span class=n>PolicyId</span>
</span></code></pre></div></p> </li> <li> <p>Redeemer <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>class</span><span class=w> </span><span class=nc>UpdateProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>project_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>user_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=n>project_output_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=k>class</span><span class=w> </span><span class=nc>UpdateToken</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>    <span class=n>project_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>    <span class=n>project_output_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=k>class</span><span class=w> </span><span class=nc>EndProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>2</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>    <span class=n>project_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>    <span class=n>user_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>    
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=n>RedeemerProject</span> <span class=o>=</span> <span class=n>Union</span><span class=p>[</span><span class=n>UpdateProject</span><span class=p>,</span> <span class=n>UpdateToken</span><span class=p>,</span> <span class=n>EndProject</span><span class=p>]</span>
</span></code></pre></div></p> </li> </ul> <p>El redeemer cuenta fundamentalmente con 3 acciones para interactuar con el contrato. 1. <strong>UpdateProject</strong>: se refiere a acciones administrativas para actualizar la información del datum. Estos cambios se pueden realizar antes de que el estado del proyecto sea &gt;=1 (distribución). A partir de este estado, se entiende que los parámetros del proyecto deben permanecer constantes durante la duración del mismo. 2. <strong>UpdateToken</strong>: Esta acción se utiliza en la creación y quema de tokens grises por parte de participantes identificados con una llave pública y participación definida. Valida las acciones asociadas a su economía como distribución y validación de topes permitidos para cada participante, actuando en conjunto con el contrato de tokens grises de tipo minteo. 3. <strong>EndProject</strong>: acción para terminar o clausurar el proyecto.</p> <ul> <li>Datum <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=k>class</span><span class=w> </span><span class=nc>DatumProjectParams</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>    <span class=n>project_id</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Project Identifier</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>    <span class=n>project_metadata</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Metadata URI or hash</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a>    <span class=n>project_state</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># 0=initialized, 1=distributed, 2=certified 3=closed</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=k>class</span><span class=w> </span><span class=nc>TokenProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>2</span>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a>    <span class=n>policy_id</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Minting policy ID for the project tokens</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a>    <span class=n>token_name</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Token name for the project tokens</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a>    <span class=n>total_supply</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Total supply of tokens for the project (Grey tokens representing carbon credits promises)</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=k>class</span><span class=w> </span><span class=nc>StakeHolderParticipation</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>3</span>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a>    <span class=n>stakeholder</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Stakeholder public name (investor, landowner, verifier, etc.) Investor is a keyword that do not require pkh)</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a>    <span class=n>pkh</span><span class=p>:</span> <span class=nb>bytes</span>  <span class=c1># Stakeholder public key hash</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a>    <span class=n>participation</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Participation amount in lovelace</span>
</span><span id=__span-10-19><a id=__codelineno-10-19 name=__codelineno-10-19 href=#__codelineno-10-19></a>    <span class=n>claimed</span><span class=p>:</span> <span class=nb>bool</span> <span class=c1># Whether the stakeholder has claimed their share of tokens</span>
</span><span id=__span-10-20><a id=__codelineno-10-20 name=__codelineno-10-20 href=#__codelineno-10-20></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-10-21><a id=__codelineno-10-21 name=__codelineno-10-21 href=#__codelineno-10-21></a><span class=k>class</span><span class=w> </span><span class=nc>Certification</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-10-22><a id=__codelineno-10-22 name=__codelineno-10-22 href=#__codelineno-10-22></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>4</span>
</span><span id=__span-10-23><a id=__codelineno-10-23 name=__codelineno-10-23 href=#__codelineno-10-23></a>    <span class=n>certification_date</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Certification date as POSIX timestamp</span>
</span><span id=__span-10-24><a id=__codelineno-10-24 name=__codelineno-10-24 href=#__codelineno-10-24></a>    <span class=n>quantity</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Quantity of carbon credits certified</span>
</span><span id=__span-10-25><a id=__codelineno-10-25 name=__codelineno-10-25 href=#__codelineno-10-25></a>    <span class=n>real_certification_date</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Real certification date as POSIX timestamp (after verification)</span>
</span><span id=__span-10-26><a id=__codelineno-10-26 name=__codelineno-10-26 href=#__codelineno-10-26></a>    <span class=n>real_quantity</span><span class=p>:</span> <span class=nb>int</span>  <span class=c1># Real quantity of carbon credits certified (after verification)</span>
</span><span id=__span-10-27><a id=__codelineno-10-27 name=__codelineno-10-27 href=#__codelineno-10-27></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-10-28><a id=__codelineno-10-28 name=__codelineno-10-28 href=#__codelineno-10-28></a><span class=k>class</span><span class=w> </span><span class=nc>DatumProject</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-10-29><a id=__codelineno-10-29 name=__codelineno-10-29 href=#__codelineno-10-29></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-10-30><a id=__codelineno-10-30 name=__codelineno-10-30 href=#__codelineno-10-30></a>    <span class=n>params</span><span class=p>:</span> <span class=n>DatumProjectParams</span>
</span><span id=__span-10-31><a id=__codelineno-10-31 name=__codelineno-10-31 href=#__codelineno-10-31></a>    <span class=n>project_token</span><span class=p>:</span> <span class=n>TokenProject</span>
</span><span id=__span-10-32><a id=__codelineno-10-32 name=__codelineno-10-32 href=#__codelineno-10-32></a>    <span class=n>stakeholders</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>StakeHolderParticipation</span><span class=p>]</span>  <span class=c1># List of stakeholders and their participation</span>
</span><span id=__span-10-33><a id=__codelineno-10-33 name=__codelineno-10-33 href=#__codelineno-10-33></a>    <span class=n>certifications</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Certification</span><span class=p>]</span>  <span class=c1># List of certification info for the project</span>
</span></code></pre></div></li> </ul> <p>El DatumProject es una agrupación de otros tipos de datos más complejos para la gestión y administración del token gris del proyecto: 1. params: DatumProjectParams 1. project_id: identificador único del proyecto 2. project_metadata: archivo de datos con información detallada del proyecto 3. project_state: estado del proyecto (0=inicializado; 1=distribuído; 2=certificado; 3=cerrado) 2. project_token: TokenProject 1. policy_id: política que gobierna los tokens grises 2. token_name: nombre del token del proyecto 3. total_supply: suministro total de tokens grises 3. stakeholders: Listado de participantes idenficados en la distribución de tokens (propietarios, administrador, socios gestores, entidad certificadora, buffer) 1. stakeholder: Nombre identificador del participante 2. pkh: Llave pública del participante 3. participation: Cantidad de tokens grises del proyecto 4. claimed: si el participante reclamó su participación 4. certifications: Listado con los periodos de certificación normalmente de periodos quinquenales. 1. certification_date_i: fecha estimada para la certificación periodo i 2. quantity_i: cantidad de créditos a certificar periodo i 3. real_certification_date_i: fecha real de certificación periodo i 4. real_quantity_i: cantidad de créditos reales certificados periodo i</p> <h4 id=validaciones-del-contrato_3>Validaciones del contrato<a class=headerlink href=#validaciones-del-contrato_3 title="Permanent link">&para;</a></h4> <ol> <li>Valida que el propósito del contrato sea de tipo "Spending"</li> <li>Valida que el input utilizado para encontrar el token de referencia sea del proyecto oficial</li> <li>Valida que no se pueda utilizar más de un utxo a la vez proveniente de la dirección del contrato</li> <li> <p>En UpdateProject - Acción para actualizar el datum por parte de un administrador del contrato (billetera que contiene el token de usuario del proyecto)</p> <ol> <li>Valida que el usuario que está interactuando con el contrato tenga su token de autorización</li> <li>Valida que el token de referencia no se envíe a una dirección distinta a la del contrato</li> <li>Valida que el datum se actualice de acuerdo a las siguientes restricciones:<ol> <li>El estado del proyecto, representado por un entero de 0 a 3 solamente puede aumentar, es decir, si se pasa al estado 1, no puede volver a su estado anterior.</li> <li>El estado del proyecto máximo es 3 ({0: "Initialized", 1: "Distributed", 2: "Certified", 3: "Closed"}).</li> <li>Se pueden cambiar todos los parámetros del datum si el estado del proyecto es 0 y siguiendo las siguientes reglas.<ol> <li>Parámetros posibles de actualización:<ol> <li>Estado del proyecto</li> <li>Suministro total</li> <li>Nombre del token gris</li> <li>Política del token gris</li> <li>Participación de los stakeholders</li> <li>Periodos para la certificación</li> </ol> </li> <li>Restricciones:<ol> <li>Suministro total no puede ser negativo</li> <li>La suma de la participación de los stakeholders debe ser menor o igual al suministro total</li> <li>La participación de los stakeholders no puede ser negativa</li> <li>El indicador de redención debe permanecer en falso durante el estado del proyecto igual a 0</li> <li>Los datos reales de certificación deben ser 0 mientras el estado del proyecto no haya llegado a la etapa 2 (certificación)</li> <li>Los datos de certificación no pueden ser negativos</li> <li>La suma de las cantidades de certificación debe ser igual al suministro total</li> </ol> </li> </ol> </li> <li>Si el estado del proyecto es mayor o igual a 1 todos los parámetros del proyecto se bloquean bajo esta acción del redeemer a excepción de:<ol> <li>Parámetros posibles de actualización:<ol> <li>Estado del proyecto</li> <li>Participación de los stakeholders</li> <li>Periodos para la certificación</li> </ol> </li> <li>Restricciones:<ol> <li>Bajo esta condición se encuentra en 1 inicialmente y puede seguir avanzando a 2 o 3 mas no disminuir</li> <li>Únicamente se permite actualizar el pkh de los stakeholders para que con esa llave pública puedan reclamar los tokens grises que les correspondan</li> <li>Únicamente se pueden cambiar los valores de fecha y cantidad real para la certificación, campos que se actualizan a medida que se van cumpliendo los hitos de certificación del proyecto. Esto es posible y ocurre únicamente cuando el estado del proyecto es igual a 1</li> <li>Los periodos para la certificación se mantienen constantes a partir del periodo 1. Sin embargo, a partir del periodo 2 es posible actualizar la fecha y cantidad real certificada teniendo en cuenta que no puede ser mayor a le fecha o cantidad inicialmente planeada.</li> </ol> </li> </ol> </li> </ol> </li> </ol> </li> <li> <p>En UpdateToken - Acción para permitir la creación de tokens grises a stakeholders identificados en los campos de participación del datum del proyecto.</p> <ol> <li>Valida que el token de referencia no se envíe a una dirección distinta del contrato mismo</li> <li>Valida que el stakeholder aparezca en el listado de participantes, tenga una llave pública registrada y firme con dicha llave. </li> <li>Valida que todos los campos del datum permanezcan constantes a excepción del parámetro claimed de los stakeholders.</li> <li>Solamente los stakeholders autorizados pueden cambiar el parametro claimed a True</li> </ol> </li> <li>En EndProject<ol> <li>Valida que el usuario que está interactuando con el contrato tenga su token de autorización</li> </ol> </li> </ol> <h4 id=minteo-de-tokens-grises>Minteo de tokens grises<a class=headerlink href=#minteo-de-tokens-grises title="Permanent link">&para;</a></h4> <p>El minteo de tokens grises es validado en conjunto por el contrato de Proyecto y el contrato Gris Ver [[#Contrato de token grises (tipo Minting)]]. 1. El contrato de Proyecto (tipo Spending) para la validación de la actualización del datum del proyecto. 2. El contrato Gris (tipo Minting). Para la validación de las políticas y restricciones de minteo del token gris del proyecto asociado.</p> <p>Esto puede suceder en dos momentos distintos:</p> <ol> <li>Free-minting Bajo la acción de <strong>UpdateProject</strong>, cuando se pasa el proyecto del estado 0 a 1 (inicializado a distribuído), el usuario administrador del contrato proyecto debe mintear los tokens grises destinados a la comercialización en el marketplace para inversionistas. Esta transacción entonces es validada por dos contratos, en lo que se refiere a la actualización del datum del proyecto, por el contrato de proyecto, y en lo que se refiere a la cantidad de tokens y las políticas de minteo por el contrato de tokens grises del proyecto asociado.</li> </ol> <p>Estos tokens grises se envían a la dirección del contrato de Inversión para custodia y comercialización. </p> <blockquote> <p>[!Warning] Es mandatorio mintear los tokens grises destinados exclusivamente a los inversionistas para la venta, acción que se conoce como "free-minting". Si esta acción de minteo de tokens grises del proyecto no se realiza y el estado del proyecto pasa a 1, no será posible crear tokens grises bajo esta modalidad y únicamente estarán disponibles los tokens grises identificados dentro del listado de stakeholders.</p> </blockquote> <ol> <li>Minteo por parte de stakeholders identificados en el listado Bajo la acción de UpdateToken, los participantes identificados en el listado pueden redimir sus tokens grises en una sola operación de minteo por exactamente la cantidad total específicada. También actúan los dos contratos en conjunto, puesto que el contrato de proyecto actualiza su datum para contabilizar los participantes que ya redimieron (claimed=True). Esta acción sólo se puede realizar cuando el estado del proyecto es igual a 1.</li> </ol> <h4 id=posibles-ataques_1>Posibles ataques<a class=headerlink href=#posibles-ataques_1 title="Permanent link">&para;</a></h4> <p>Escenarios: - Dos operaciones de minteo modificando el suministro de distintos stakeholders en la misma transacción.</p> <h3 id=contrato-de-token-grises-tipo-minting>Contrato de token grises (tipo Minting)<a class=headerlink href=#contrato-de-token-grises-tipo-minting title="Permanent link">&para;</a></h3> <p>Gestiona la creación y quema de tokens grises asociados a un proyecto utilizando como información de entrada principal la que se encuentra en el datum del proyecto, en particular la asociada a la economía del token, a su distribución y participación. </p> <ul> <li> <p>Parámetros <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>project_id</span><span class=p>:</span> <span class=n>PolicyId</span>
</span></code></pre></div></p> </li> <li> <p>Redeemer <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>class</span><span class=w> </span><span class=nc>Mint</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>0</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>    <span class=n>project_input_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a>    <span class=n>project_output_index</span><span class=p>:</span> <span class=nb>int</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=nd>@dataclass</span><span class=p>()</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=k>class</span><span class=w> </span><span class=nc>Burn</span><span class=p>(</span><span class=n>PlutusData</span><span class=p>):</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=n>CONSTR_ID</span> <span class=o>=</span> <span class=mi>1</span>
</span></code></pre></div></p> </li> </ul> <h4 id=validaciones-del-contrato_4>Validaciones del contrato<a class=headerlink href=#validaciones-del-contrato_4 title="Permanent link">&para;</a></h4> <ol> <li>Valida que el propósito del contrato sea de tipo "Minting"</li> <li>Valida que un solo tipo de token (policyId y nombre) sea creado o destruído</li> <li></li> <li>Para minteo:<ol> <li>Valida que se exista un utxo de entrada con el datum del proyecto y que ese utxo contenga el token de referencia del proyecto.</li> <li>Valida que el policyId del token gris registrado en el datum del proyecto sea igual al del contrato de token grises.</li> <li>Valida que se esté creando el token con el nombre registrado en el datum del proyecto</li> <li>Valida que se creen cantidades positivas</li> <li>Valida el estado del proyecto para permitir acciones de minteo de la siguiente forma:<ol> <li>Periodo <strong>Free-minting</strong>:<ol> <li>El estado del proyecto debe pasar del estado 0 al 1.</li> <li>Valida que la cantidad a crear sea la diferencia entre el suministro total y la participación total de los stakeholders.</li> </ol> </li> <li>Minteo de participantes listados:<ol> <li>Verifica que el estado del proyecto esté en 1.</li> <li>Verifica que la transacción esté firmada por un participante identificado en la lista y que corresponda al pkh listado</li> <li>Sólo la cantidad del participante firmante es la que puede mintear.</li> <li>Verifica que a la salida del datum del proyecto el estado de redención (claimed) sea verdadero.</li> <li>Verifica que la dirección de envío de los tokens corresponda a la de la llave pública (pkh) del firmante.</li> </ol> </li> </ol> </li> </ol> </li> </ol> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 14, 2025 15:38:55 UTC">October 14, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 14, 2025 15:38:55 UTC">October 14, 2025</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Terrasacha </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/SuanBlockchain/terrasacha-contracts target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>